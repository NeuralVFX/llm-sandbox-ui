# Cells


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

------------------------------------------------------------------------

### interrupt_button

``` python

def interrupt_button(
    cell_id
):

```

*Create an interrupt button that aborts the active stream for a cell.*

Args: cell_id: Unique cell identifier.

Returns: Button component that POSTs to /interrupt/{cell_id}.

------------------------------------------------------------------------

### BaseCell

``` python

def BaseCell(
    source:str='', outputs:str='', cell_id:NoneType=None
):

```

*Base class for all notebook cell types.*

Attributes: cell_type (str): Type identifier (‘markdown’, ‘code’,
‘llm’). source (str): Cell content/code. outputs (list): Cell execution
outputs (empty for markdown). cell_id (str): Unique cell identifier.

------------------------------------------------------------------------

### PromptCell

``` python

def PromptCell(
    source:str='', outputs:str='', cell_id:NoneType=None
):

```

*Cell for LLM prompts with streaming markdown responses.*

Stores user prompt in source and LLM response in outputs. Serializes to
ipynb as markdown with PROMPT_SPLIT separator.

------------------------------------------------------------------------

### MarkdownCell

``` python

def MarkdownCell(
    source:str='', outputs:str='', cell_id:NoneType=None
):

```

*Static markdown documentation cell.*

Displays rendered markdown with toggle to edit source. No execution or
outputs - purely for notes and documentation.

------------------------------------------------------------------------

### CodeCell

``` python

def CodeCell(
    source:str='', outputs:str='', cell_id:NoneType=None
):

```

*Executable Python code cell with Monaco editor.*

Executes code via kernel and displays Jupyter-style outputs (streams,
execute_result, display_data, errors).

``` python
class AgentCell(BaseCell):
    """Autonomous code generation cell with iterative refinement.
    
    Combines a prompt input, Monaco code editor, and dual output areas
    (unit test results + LLM review). Runs generate→test→improve loops
    until code passes review.
    
    Attributes:
        source_prompt: User's code generation request.
        source_code: Generated/edited Python code.
        outputs_llm: Agent review markdown.
        outputs_code: Unit test execution outputs.
    """
    cell_type = 'agent'


    def __init__(self, source_prompt="", source_code="", outputs="", outputs_llm="",outputs_code="", cell_id=None):
        super().__init__(source="", outputs=outputs, cell_id=cell_id)
        self.source_prompt = source_prompt
        self.source_code = source_code
        self.outputs_llm = outputs_llm
        self.outputs_code = outputs_code

    @classmethod
    def from_ipynb(cls, cell_dict):
        """ Load From Ipynb Dict"""

        source_txt = ''.join(cell_dict['source'])
        code = ""  # ← Add default
        if AGENT_CODE_SPLIT in source_txt:
            prompt, code = source_txt.split(AGENT_CODE_SPLIT)
            re_outputs = re.search(r'```python\n(.*?)\n```', code, re.DOTALL)
            if re_outputs:
                code = re_outputs.group(1)
        else:
            prompt = source_txt

        return cls(source_prompt=prompt, 
                source_code=code,
                cell_id=cell_dict['id'])

    def to_ipynb(self):
        """ Build Ipynb Dict"""

        out_dict = {
            'id':self.cell_id,
            'cell_type': 'markdown',
            'metadata': {'id': self.cell_id, 'agent_cell': True}
        }
        
        # Combine prompt + code with separator
        if self.source_code:
            source_text = self.source_prompt + AGENT_CODE_SPLIT + '```python\n' + self.source_code + '\n```'
        else:
            source_text = self.source_prompt
        
        out_dict['source'] = source_text.splitlines(keepends=True)
        
        return out_dict

    def build_left_buttons(self):
        """Build cell-specific left button group (play, stop, etc)."""
        
        return Div(
                Div(
                    Button(play_ic,
                            onClick=f"executeAgentCell('{self.cell_id}')",
                            cls=cell_button_format),
                    interrupt_button(self.cell_id),
                    Button(clean_ic,
                            onClick=f"clearOutput('{self.cell_id}')",
                            cls=cell_button_format),
                    Label(edit_ic,
                            cls=cell_button_format + ' toggle-label'),
                ),
                cls='flex justify-start'
                )

    def build_source_area(self):
        """Build editable source code/markdown area."""

        markdown_source = self.build_markdown_source_area(self.source_prompt,round_b=False)

        monaco_editor_script = self.build_monaco_editor(self.cell_id,self.source_code,100,300)
       

        editor_div = Div(id=f'monaco-{self.cell_id}', 
                        style='height: 20px; width: 100%; overflow: hidden',
                        cls='monaco-editor')

        agent_in = Div("Prompt", cls=label_css),

        code_in = Div(
            Div("Agent Code", cls="flex-shrink-0"),
            Div("Idle", id=f"status", 
                cls="flex-grow px-3 py-0.5 bg-gray-900 rounded text-center text-xs"),
            Div("Iteration: NA", id=f"iteration",
                cls="flex-shrink-0 px-2 py-0.5 bg-gray-900 rounded text-xs"),
            cls="flex items-center gap-2 text-xs text-gray-400 px-2 py-1 bg-gray-800"
        )


        return [agent_in, *markdown_source,code_in,editor_div, monaco_editor_script]

    def build_output_area(self):
        """Build output display area (if applicable)."""

        ### Code Out
        outputs_json = json.dumps(self.outputs_code) if self.outputs_code else '[]'
        output_area_code = self.build_code_output(tag='-code',min_height=100, max_height=300, outputs_json=outputs_json, round_b=False)

        ### LLM Out
        outputs_json = self.outputs_llm if self.outputs_llm else ''
        output_area_llm = self.build_llm_output( tag='-llm',min_height=100, max_height=300, outputs_json=outputs_json)


        agent_out = Div("Agent Output", cls=label_css),
        code_out = Div("Unit Test Output", cls=label_css),

        return [code_out,*output_area_code,agent_out,*output_area_llm]

    def render(self):
        """Render cell as FastHTML component tree."""

        toggle_input = Input(type='checkbox', cls="hidden toggle-edit")

        menu_bar = self.build_top_menu()
        source_area = self.build_source_area()
        output_area = self.build_output_area()
        
        watch_script = Script(f"""
            setTimeout(() => {{
                watchOutputStore('{self.cell_id}');
            }}, 50);
        """)

        return Div(
            watch_script,
            toggle_input,
            menu_bar,
            *source_area,
            *output_area,
            self._make_markdown_init_script(),
            cls='w-full shadow-xl p-2',
            data_cell_type=self.cell_type,
            data_cell_id=self.cell_id
        )
```
